<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <title>Demo Web App</title>
    <style>
        p {
            font-size: 18px;
        }

        .card {
            width: 18rem;
        }
    </style>
</head>

<body class="bg-secondary">
    <div class="container min-vh-100 bg-white">
        <section class="bg-primary py-3 mb-3 text-white" style="margin-right: -12px; margin-left: -12px">
            <h2 class="mb-0 text-center">
                <span>
                    <?xml version="1.0" encoding="utf-8"?>
                    <!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->
                    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
                    <svg style="width: 80px; padding-bottom: 20px" version="1.1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000"
                        enable-background="new 0 0 1000 1000" xml:space="preserve">
                        <g>
                            <g transform="translate(0.000000,398.000000) scale(0.100000,-0.100000)">
                                <path fill="#ffffff"
                                    d="M3593.4,1999.2c-740.4-92-1399.5-492.1-1802.7-1096c-256-386.3-392.4-794-416.9-1253.9l-10.7-197.7l-110.4-42.9c-217.7-84.3-398.5-211.5-597.8-418.5c-292.8-306.6-492-705.1-544.2-1091.4c-23-170.1-7.7-478.3,32.2-625.4c161-607,760.3-1119,1505.3-1286.1l159.4-35.2h3196c3027.4,0,3202.2,1.5,3326.3,27.6c746.5,159.4,1318.3,628.5,1526.7,1252.3c42.9,125.7,44.5,139.5,42.9,436.9c0,288.2-3.1,314.2-41.4,441.5c-203.9,662.2-778.7,1217.1-1434.8,1384.2c-78.2,19.9-165.5,36.8-191.6,36.8c-70.5,0-79.7,13.8-92,125.7c-29.1,302-210,625.4-458.3,824.7C7568.1,572.1,7350.5,684,7211,722.4c-76.7,19.9-156.4,27.6-337.2,27.6c-228.4-1.5-243.7-3.1-383.2-50.6c-79.7-27.6-185.5-75.1-236.1-104.2c-49-29.1-92-50.6-93.5-49c-1.5,3.1-35.2,67.4-75.1,142.5C5744,1352.4,5069.6,1838.3,4303.1,1976.2C4139.1,2005.4,3751.3,2017.6,3593.4,1999.2z M7177.3-896.4c223.8-69,340.3-228.4,352.6-479.8l6.1-134.9h-185.5H7165v76.6c0,124.2-52.1,223.8-141,269.8c-59.8,30.7-194.7,42.9-269.8,23c-167.1-46-257.5-240.7-200.8-432.3c39.9-131.8,151.8-210,455.3-318.8c328-118,455.3-205.4,535-366.4c41.4-82.8,42.9-98.1,42.9-294.3c0-179.3-4.6-219.2-35.3-294.3c-41.4-102.7-147.2-226.9-240.7-280.5c-148.7-87.4-476.7-127.2-685.2-82.8c-176.3,38.3-334.2,154.8-410.8,305c-39.8,79.7-76.6,240.7-76.6,349.5v79.7h182.4h180.9l9.2-116.5c10.7-145.6,56.7-240.7,145.6-303.5c56.7-39.9,79.7-46,199.3-52.1c118-4.6,141-1.5,202.3,30.7c38.3,21.5,88.9,67.5,115,102.7c38.3,55.2,46,82.8,50.6,179.3c12.3,240.7-65.9,329.6-390.9,443c-282,98.1-406.2,162.5-502.8,259.1c-115,113.4-150.2,214.6-151.8,423.1c-1.5,183.9,23,275.9,104.2,389.4c92,130.3,245.3,220.7,427.7,254.4C6827.8-847.3,7065.4-861.1,7177.3-896.4z M3332.8-2039.9l300.4-1134.3l-183.9-4.6c-101.2-1.5-187,1.5-193.1,7.7c-6.1,6.1-41.4,131.8-78.2,275.9l-67.4,265.2h-337.2h-338.8l-59.8-225.3c-32.2-125.7-64.4-249.9-72-277.4l-13.8-49.1h-193.1c-147.1,0-190.1,4.6-185.5,19.9c3.1,9.2,151.8,524.2,328,1142l320.4,1122.1l236.1-3.1l237.6-4.6L3332.8-2039.9z M4114.6-1771.6c81.2-476.7,151.8-875.3,154.8-886c6.1-16.9,306.6,1706.1,305,1749c0,6.1,88.9,10.7,196.2,10.7h196.2l150.2-869.1c81.2-479.8,153.3-881.4,157.9-893.7c3.1-12.3,75.1,377.1,157.9,866.1c84.3,489,151.8,890.6,151.8,893.7c1.5,1.5,81.2,3.1,177.8,3.1c144.1,0,176.3-4.6,176.3-23c0-12.3-99.6-519.6-222.3-1128.2c-122.6-608.6-222.3-1112.9-222.3-1119c0-7.7-96.6-13.8-213.1-13.8c-190.1,0-214.6,3.1-222.3,27.6c-3.1,13.8-70.5,400.1-148.7,856.9c-78.2,456.8-144.1,829.3-147.2,826.2c-3.1-1.5-65.9-369.4-142.6-815.5c-76.6-446.1-142.6-829.3-147.2-853.8l-9.2-41.4h-211.5h-213.1l-15.3,81.2c-9.2,42.9-105.8,541.1-216.1,1106.7c-108.8,565.6-202.3,1042.3-206.9,1062.3l-9.2,35.3l188.5-4.6l187-4.6L4114.6-1771.6z" />
                                <path fill="#ffffff"
                                    d="M2643.1-1757.8c-72-295.8-131.8-547.2-134.9-559.5c-4.6-18.4,38.3-21.5,263.6-21.5c148.7,0,269.8,4.6,271.3,12.3c1.5,23-254.5,1106.7-262.1,1106.7C2776.4-1219.8,2715.1-1462,2643.1-1757.8z" />
                            </g>
                        </g>
                    </svg>
                </span>

                A Python Web App
            </h2>
            <p class="text-center">This app is hosted on an AWS EC2 instance, or a group of EC2 instances. </p>
        </section>

        <section>
            <h3 class="mb-3 text-center text-primary">EC2 information</h3>
            <p class="text-center">The information of the instance which processed current http requst is display below.
            </p>
            {% if data.is_ec2 == False %}
            <div class="alert alert-warning text-center" role="alert">Failed to retrieve EC2 id. If error persists,
                check if the server is a AWS EC2 instance.</div>
            {% endif %}
            <div class="d-flex flex-column flex-md-row align-items-center justify-content-center mb-3">
                {% for item in data.ec2_self %}
                <div class="card m-2">
                    <div class="card-body pt-0 px-0">
                        <h5 class="card-title text-center text-white bg bg-secondary py-2 mb-3">{{ item.title }}</h5>
                        <p class="card-text text-center text-primary fw-bold">{{ item.value }}</p>
                    </div>
                </div>
                {% endfor %}

            </div>
        </section>

        <hr class="hr hr-blurry my-4" />
        <section>
            <h3 class="mb-3 text-center text-primary">S3 static content server</h3>
            {% if data.static_base_url is not defined or data.static_base_url is none %}
            <div class="alert alert-warning text-center" role="alert">Static content server is not available. Fallback
                to EC2 local images</div>
            {% else %}
            <p class="text-center ">
                Static content server is configured. Base url is
                <br />
                <span class="text-info-emphasis text-decoration-underline">{{data.static_base_url}}</span>
            </p>
            {% endif %}
            <p class="text-center ">Click the links below to check the URL information of the static image.</p>
            <div class=" d-flex justify-content-center">

                <div class="p-3">
                    {% if data.static_base_url is not defined or data.static_base_url is none %}
                    <div class="text-center mb-1"><a target="_blank"
                            class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
                            href="{{ url_for('static', filename='amazon_ec2.png') }}">Img Link</a></div>
                    <img class="img-fluid" width="80px" src="{{ url_for('static', filename='amazon_ec2.png') }}">
                    {% else %}
                    <div class="text-center mb-1"><a target="_blank"
                            class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
                            href="{{data.static_base_url + '/amazon_ec2.png'}}">Img Link</a></div>
                    <img class="img-fluid" width="80px" src="{{data.static_base_url + '/amazon_ec2.png'}}">
                    {% endif %}

                </div>
                <div class="p-3">
                    {% if data.static_base_url is not defined or data.static_base_url is none %}
                    <div class="text-center mb-1"><a target="_blank"
                            class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
                            href="{{ url_for('static', filename='python.png') }}">Img Link</a></div>
                    <img class="img-fluid" width="80px" src="{{ url_for('static', filename='python.png') }}">
                    {% else %}
                    <div class="text-center mb-1"><a target="_blank"
                            class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
                            href="{{data.static_base_url + '/python.png'}}">Img Link</a></div>
                    <img class="img-fluid" width="80px" src="{{data.static_base_url + '/python.png'}}">
                    {% endif %}
                </div>
            </div>
        </section>
        <hr class="hr hr-blurry my-4" />
        <section>
            <h3 class="mb-3 text-center text-primary">EC2 Server status</h3>
            {% if data.ec2_servers.db_connected %}
            <p class="text-center">Database connected. The status of all EC2 web servers is displayed below.</p>
            <table class="table mx-auto text-center" style="max-width: 700px;">
                <thead>
                    <tr>
                        <th scope="col">Instance ID</th>
                        <th scope="col">Local IP</th>
                        <th scope="col">Public IP:Port</th>
                        <th scope="col">Current</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data.ec2_servers.servers %}
                    {% if item.current %}
                    <tr class="bg-primary bg-opacity-10">
                        {% else %}
                    <tr>
                        {% endif %}
                        <td>{{item.instance_id}}</td>
                        <td>{{item.local_ip}}</td>
                        <td>{{item.public_ip}}:{{item.app_port}}
                            <a target="_blank"
                                class="ms-2 link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
                                href="http://{{item.public_ip}}:{{item.app_port}}">
                                <i class="bi bi-box-arrow-up-right"></i>
                            </a>
                        </td>
                        <td>
                            {% if item.current %}
                            <i class="bi bi-check-lg text-primary"></i>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    <!-- <tr class="bg-primary bg-opacity-10">
                        <td>i-0a1234567890abcdef</td>
                        <td>127.0.0.1</td>
                        <td>3.10.23.220:8080</td>
                        <td><i class="bi bi-check-lg text-primary"></i></td>
                    </tr> -->

                </tbody>
            </table>
            {% else %}
            <div class="alert alert-warning text-center" role="alert">
                EC2 server status is not available. Please check the database connection.
            </div>
            {% endif %}
        </section>
        <section class="bg-primary py-3 mt-5 text-white" style="margin-right: -12px; margin-left: -12px">
            <p class="fs-6 text-center m-0">&copy; 2023 Qiao Li. All rights reserved.</p>
        </section>
    </div>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>


    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
</body>

</html>